<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Biblioteca Virtual</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;700&family=Fraunces:opsz,wght@9..144,600;9..144,700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
<div class="bg-orb bg-orb-a"></div>
<div class="bg-orb bg-orb-b"></div>

<nav class="navbar navbar-expand-lg navbar-dark topbar">
    <div class="container">
        <a class="navbar-brand brand" href="{{ url_for('index') }}">
            <span class="brand-mark">BV</span>
            <span>
                <strong>Biblioteca Virtual</strong>
                <small>controle de acervo</small>
            </span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto gap-lg-2">
                <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Inicio</a></li>

                {% if current_user.is_authenticated and current_user.tipo == 'admin' %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('adicionar') }}">Adicionar</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('usuarios') }}">Usuarios</a></li>
                {% endif %}

                {% if current_user.is_authenticated and current_user.tipo == 'usuario' %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('meus_livros') }}">Emprestimos</a></li>
                {% endif %}
            </ul>

            <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-2">
                {% if current_user.is_authenticated %}
                    <li class="nav-item user-chip">
                        {{ current_user.nome }} | {{ current_user.tipo }}
                    </li>
                    <li class="nav-item">
                        <form
                            method="POST"
                            action="{{ url_for('logout') }}"
                            class="d-inline js-confirm-action"
                            data-confirm-title="Confirmar saida"
                            data-confirm-message="Deseja encerrar sua sessao agora?"
                            data-confirm-button="Sair"
                            data-confirm-variant="btn-outline-danger"
                        >
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" class="btn btn-outline-light btn-sm">Sair</button>
                        </form>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a href="{{ url_for('login') }}" class="btn btn-outline-light btn-sm">Login</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<main class="container py-4 py-lg-5">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for categoria, mensagem in messages %}
                <div class="alert alert-{{ categoria }} alert-dismissible fade show surface-alert" role="alert">
                    {{ mensagem }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
</main>

<div class="modal fade" id="actionConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content confirm-modal">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title" id="actionConfirmTitle">Confirmar acao</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body pt-2">
                <p class="mb-0 muted" id="actionConfirmMessage">Tem certeza que deseja continuar?</p>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="actionConfirmSubmit">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (() => {
        const modalEl = document.getElementById("actionConfirmModal");
        if (!modalEl) return;

        const titleEl = document.getElementById("actionConfirmTitle");
        const messageEl = document.getElementById("actionConfirmMessage");
        const confirmBtn = document.getElementById("actionConfirmSubmit");
        const modal = new bootstrap.Modal(modalEl);

        let currentForm = null;

        function openConfirm(form) {
            const title = form.dataset.confirmTitle || "Confirmar acao";
            const message = form.dataset.confirmMessage || "Tem certeza que deseja continuar?";
            const button = form.dataset.confirmButton || "Confirmar";
            const variant = form.dataset.confirmVariant || "btn-primary";

            titleEl.textContent = title;
            messageEl.textContent = message;
            confirmBtn.textContent = button;
            confirmBtn.className = `btn ${variant}`;
            currentForm = form;
            modal.show();
        }

        document.addEventListener("submit", (event) => {
            const form = event.target;
            if (!(form instanceof HTMLFormElement) || !form.classList.contains("js-confirm-action")) {
                return;
            }

            if (form.dataset.confirmed === "true") {
                form.dataset.confirmed = "false";
                return;
            }

            event.preventDefault();
            openConfirm(form);
        });

        confirmBtn.addEventListener("click", () => {
            if (!currentForm) return;
            currentForm.dataset.confirmed = "true";
            modal.hide();
            currentForm.requestSubmit();
        });
    })();
</script>
</body>
</html>
